
name: Update Data.json on gh-pages

on:
  schedule:
    - cron: '0 * * * *' # Co godzinÄ™
  workflow_dispatch: # RÄ™cznie
  repository_dispatch: # Z Google Apps Script
    types: [update_products]

permissions:
  contents: write

jobs:
  update-live-data:
    runs-on: ubuntu-latest
    steps:
      # 1. Pobieramy kod ÅºrÃ³dÅ‚owy z MAIN (Å¼eby mieÄ‡ dostÄ™p do skryptÃ³w generujÄ…cych)
      - name: Checkout Source (main)
        uses: actions/checkout@v4
        with:
          ref: main

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies
        run: npm ci

      # 2. Uruchamiamy skrypt, ktÃ³ry tworzy plik public/data.json
      - name: Fetch Latest Products Data
        run: npm run update-data

      # 3. Przygotowujemy folder do wysyÅ‚ki
      # Tworzymy czysty folder i kopiujemy tam TYLKO wygenerowany data.json
      - name: Prepare Deployment Payload
        run: |
          mkdir deploy_payload
          cp public/data.json deploy_payload/data.json

      # 4. WysyÅ‚amy TYLKO ten plik na branch gh-pages
      # Opcja keep_files: true jest KLUCZOWA - sprawia, Å¼e reszta strony nie znika!
      - name: Deploy JSON to gh-pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy_payload
          publish_branch: gh-pages
          keep_files: true 
          commit_message: "ðŸ¤– Data Update: data.json (Live)"
